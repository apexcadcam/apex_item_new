#!/bin/bash
# This script runs automatically after bench get-app clones the repository
# It ensures apex_item is in sites/apps.txt before bench build runs

cd "$(dirname "$0")/../.." || exit

if [ -f "sites/apps.txt" ]; then
	if ! grep -q "^apex_item$" sites/apps.txt; then
		# Ensure file ends with newline before appending
		if [ -s sites/apps.txt ]; then
			# Remove trailing whitespace and ensure newline
			sed -i 's/[[:space:]]*$//' sites/apps.txt
			if [ "$(tail -c 1 sites/apps.txt)" != "" ]; then
				echo "" >> sites/apps.txt
			fi
		fi
		echo "apex_item" >> sites/apps.txt
		echo "âœ… Added apex_item to sites/apps.txt"
	fi
fi

